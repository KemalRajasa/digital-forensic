(()=>{var Ee=(ve,fe)=>()=>(fe||ve((fe={exports:{}}).exports,fe),fe.exports);var Ce=Ee((be,ye)=>{(function(fe,ee){typeof be=="object"&&typeof ye=="object"?ye.exports=ee():typeof define=="function"&&define.amd?define([],ee):typeof be=="object"?be.subsSdkScript=ee():fe.subsSdkScript=ee()})(self,function(){return(()=>{var ve={1866:(O,d)=>{const a=(typeof window=="undefined"?process.env:window.env)||{};d.env=a,d.validateEnvVars=(m=[],l=!1)=>{const H=m.reduce((q,T)=>a[T]?q:[...q,T],[]),S=H.length>0,x=`Missing required env variables: '${H.join(", ")}'. Make sure you have a '.env' file or that you are running a command with inline environment variables.`;if(S&&l)throw new Error(x);S&&!l&&console.warn(x)},d.getEnv=m=>a[`${m}_CLIENT`]||null},8103:(O,d)=>{const a="trace",m="debug",l="info",H="warn",S="error";d.TRACE=a,d.DEBUG=m,d.INFO=l,d.WARN=H,d.ERROR=S,d.DEFAULT_LOG_LEVEL=S,d.LOG_LEVELS=[a,m,l,H,S]},8048:(O,d,a)=>{var m=Object.defineProperty,l=Object.defineProperties,H=Object.getOwnPropertyDescriptors,S=Object.getOwnPropertySymbols,x=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable,T=(_,b,k)=>b in _?m(_,b,{enumerable:!0,configurable:!0,writable:!0,value:k}):_[b]=k,U=(_,b)=>{for(var k in b||(b={}))x.call(b,k)&&T(_,k,b[k]);if(S)for(var k of S(b))q.call(b,k)&&T(_,k,b[k]);return _},F=(_,b)=>l(_,H(b));const{env:K}=a(1866),A=a(1953),{DEFAULT_LOG_LEVEL:M,LOG_LEVELS:E}=a(8103),G=a(8103),r=K.LOG_LEVEL||M,v=K.NODE_ENV!=="production",f=A({level:r,prettyPrint:v?{colorize:!0}:void 0,serializers:{err:A.stdSerializers.err,error:A.stdSerializers.err}});function V(_,b={}){return f.child(U({namespace:_},b))}function P(_=M){f&&E.includes(_)&&(f.level=_)}O.exports=F(U({},G),{createLogger:V,setLevel:P})},1953:(O,d,a)=>{"use strict";var m=a(1493);O.exports=S;var l=a.g.console||{},H={req:E,res:E,err:M};function S(r){r=r||{},r.browser=r.browser||{};var v=r.browser.transmit;if(v&&typeof v.send!="function")throw Error("pino: transmit option must have a send function");var f=r.browser.write||l;r.browser.write&&(r.browser.asObject=!0);var V=r.serializers||{},P=Array.isArray(r.browser.serialize)?r.browser.serialize.filter(function(g){return g!=="!stdSerializers.err"}):r.browser.serialize===!0?Object.keys(V):!1,_=r.browser.serialize;Array.isArray(r.browser.serialize)&&r.browser.serialize.indexOf("!stdSerializers.err")>-1&&(_=!1);var b=["error","fatal","warn","info","debug","trace"];typeof f=="function"&&(f.error=f.fatal=f.warn=f.info=f.debug=f.trace=f),r.enabled===!1&&(r.level="silent");var k=r.level||"info",p=Object.create(f);p.log||(p.log=G),Object.defineProperty(p,"levelVal",{get:t}),Object.defineProperty(p,"level",{get:C,set:e});var J={transmit:v,serialize:P,asObject:r.browser.asObject,levels:b};p.levels=S.levels,p.level=k,p.setMaxListeners=p.getMaxListeners=p.emit=p.addListener=p.on=p.prependListener=p.once=p.prependOnceListener=p.removeListener=p.removeAllListeners=p.listeners=p.listenerCount=p.eventNames=p.write=p.flush=G,p.serializers=V,p._serialize=P,p._stdErrSerialize=_,p.child=c,v&&(p._logEvent=A());function t(){return this.level==="silent"?1/0:this.levels.values[this.level]}function C(){return this._level}function e(g){if(g!=="silent"&&!this.levels.values[g])throw Error("unknown level "+g);this._level=g,x(J,p,"error","log"),x(J,p,"fatal","error"),x(J,p,"warn","error"),x(J,p,"info","log"),x(J,p,"debug","log"),x(J,p,"trace","log")}function c(g){if(!g)throw new Error("missing bindings for child Pino");var te=g.serializers;if(P&&te){var Z=Object.assign({},V,te),j=r.browser.serialize===!0?Object.keys(Z):P;delete g.serializers,U([g],j,Z,this._stdErrSerialize)}function z(h){this._childLevel=(h._childLevel|0)+1,this.error=F(h,g,"error"),this.fatal=F(h,g,"fatal"),this.warn=F(h,g,"warn"),this.info=F(h,g,"info"),this.debug=F(h,g,"debug"),this.trace=F(h,g,"trace"),Z&&(this.serializers=Z,this._serialize=j),v&&(this._logEvent=A([].concat(h._logEvent.bindings,g)))}return z.prototype=this,new z(this)}return p}S.LOG_VERSION=1,S.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{"10":"trace","20":"debug","30":"info","40":"warn","50":"error","60":"fatal"}},S.stdSerializers=H;function x(r,v,f,V){var P=Object.getPrototypeOf(v);v[f]=v.levelVal>v.levels.values[f]?G:P[f]?P[f]:l[f]||l[V]||G,q(r,v,f)}function q(r,v,f){!r.transmit&&v[f]===G||(v[f]=function(V){return function(){for(var _=Date.now(),b=new Array(arguments.length),k=Object.getPrototypeOf&&Object.getPrototypeOf(this)===l?l:this,p=0;p<b.length;p++)b[p]=arguments[p];if(r.serialize&&!r.asObject&&U(b,this._serialize,this.serializers,this._stdErrSerialize),r.asObject?V.call(k,T(this,f,b,_)):V.apply(k,b),r.transmit){var J=r.transmit.level||v.level,t=S.levels.values[J],C=S.levels.values[f];if(C<t)return;K(this,{ts:_,methodLevel:f,methodValue:C,transmitLevel:J,transmitValue:S.levels.values[r.transmit.level||v.level],send:r.transmit.send,val:v.levelVal},b)}}}(v[f]))}function T(r,v,f,V){r._serialize&&U(f,r._serialize,r.serializers,r._stdErrSerialize);var P=f.slice(),_=P[0],b={time:V,level:S.levels.values[v]},k=(r._childLevel|0)+1;if(k<1&&(k=1),_!==null&&typeof _=="object"){for(;k--&&typeof P[0]=="object";)Object.assign(b,P.shift());_=P.length?m(P.shift(),P):void 0}else typeof _=="string"&&(_=m(P.shift(),P));return _!==void 0&&(b.msg=_),b}function U(r,v,f,V){for(var P in r)if(V&&r[P]instanceof Error)r[P]=S.stdSerializers.err(r[P]);else if(typeof r[P]=="object"&&!Array.isArray(r[P]))for(var _ in r[P])v&&v.indexOf(_)>-1&&_ in f&&(r[P][_]=f[_](r[P][_]))}function F(r,v,f){return function(){var V=new Array(1+arguments.length);V[0]=v;for(var P=1;P<V.length;P++)V[P]=arguments[P-1];return r[f].apply(this,V)}}function K(r,v,f){var V=v.send,P=v.ts,_=v.methodLevel,b=v.methodValue,k=v.val,p=r._logEvent.bindings;U(f,r._serialize||Object.keys(r.serializers),r.serializers,r._stdErrSerialize===void 0?!0:r._stdErrSerialize),r._logEvent.ts=P,r._logEvent.messages=f.filter(function(J){return p.indexOf(J)===-1}),r._logEvent.level.label=_,r._logEvent.level.value=b,V(_,r._logEvent,k),r._logEvent=A(p)}function A(r){return{ts:0,messages:[],bindings:r||[],level:{label:"",value:0}}}function M(r){var v={type:r.constructor.name,msg:r.message,stack:r.stack};for(var f in r)v[f]===void 0&&(v[f]=r[f]);return v}function E(){return{}}function G(){}},1493:O=>{"use strict";function d(m){try{return JSON.stringify(m)}catch(l){return'"[Circular]"'}}O.exports=a;function a(m,l,H){var S=H&&H.stringify||d,x=1;if(m===null&&(m=l[0],x=0),typeof m=="object"&&m!==null){var q=l.length+x;if(q===1)return m;var T=new Array(q);T[0]=S(m);for(var U=1;U<q;U++)T[U]=S(l[U]);return T.join(" ")}var F=l.length;if(F===0)return m;for(var K="",A="",M=1-x,E=0,G=m&&m.length||0,r=0;r<G;){if(m.charCodeAt(r)===37&&r+1<G){switch(m.charCodeAt(r+1)){case 100:if(M>=F||(E<r&&(A+=m.slice(E,r)),l[M]==null))break;A+=Number(l[M]),E=r=r+2;break;case 79:case 111:case 106:if(M>=F||(E<r&&(A+=m.slice(E,r)),l[M]===void 0))break;var v=typeof l[M];if(v==="string"){A+="'"+l[M]+"'",E=r+2,r++;break}if(v==="function"){A+=l[M].name||"<anonymous>",E=r+2,r++;break}A+=S(l[M]),E=r+2,r++;break;case 115:if(M>=F)break;E<r&&(A+=m.slice(E,r)),A+=String(l[M]),E=r+2,r++;break;case 37:E<r&&(A+=m.slice(E,r)),A+="%",E=r+2,r++;break}++M}++r}for(E===0?A=m:E<G&&(A+=m.slice(E));M<F;)K=l[M++],K===null||typeof K!="object"?A+=" "+String(K):A+=" "+S(K);return A}},9639:function(O,d,a){O=a.nmd(O);var m;/*! https://mths.be/punycode v1.3.2 by @mathias */(function(l){var H=d&&!d.nodeType&&d,S=O&&!O.nodeType&&O,x=typeof a.g=="object"&&a.g;(x.global===x||x.window===x||x.self===x)&&(l=x);var q,T=2147483647,U=36,F=1,K=26,A=38,M=700,E=72,G=128,r="-",v=/^xn--/,f=/[^\x20-\x7E]/,V=/[\x2E\u3002\uFF0E\uFF61]/g,P={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},_=U-F,b=Math.floor,k=String.fromCharCode,p;function J(i){throw RangeError(P[i])}function t(i,u){for(var w=i.length,I=[];w--;)I[w]=u(i[w]);return I}function C(i,u){var w=i.split("@"),I="";w.length>1&&(I=w[0]+"@",i=w[1]),i=i.replace(V,".");var L=i.split("."),D=t(L,u).join(".");return I+D}function e(i){for(var u=[],w=0,I=i.length,L,D;w<I;)L=i.charCodeAt(w++),L>=55296&&L<=56319&&w<I?(D=i.charCodeAt(w++),(D&64512)==56320?u.push(((L&1023)<<10)+(D&1023)+65536):(u.push(L),w--)):u.push(L);return u}function c(i){return t(i,function(u){var w="";return u>65535&&(u-=65536,w+=k(u>>>10&1023|55296),u=56320|u&1023),w+=k(u),w}).join("")}function g(i){return i-48<10?i-22:i-65<26?i-65:i-97<26?i-97:U}function te(i,u){return i+22+75*(i<26)-((u!=0)<<5)}function Z(i,u,w){var I=0;for(i=w?b(i/M):i>>1,i+=b(i/u);i>_*K>>1;I+=U)i=b(i/_);return b(I+(_+1)*i/(i+A))}function j(i){var u=[],w=i.length,I,L=0,D=G,$=E,R,re,ne,oe,Y,se,Q,ae,ce;for(R=i.lastIndexOf(r),R<0&&(R=0),re=0;re<R;++re)i.charCodeAt(re)>=128&&J("not-basic"),u.push(i.charCodeAt(re));for(ne=R>0?R+1:0;ne<w;){for(oe=L,Y=1,se=U;ne>=w&&J("invalid-input"),Q=g(i.charCodeAt(ne++)),(Q>=U||Q>b((T-L)/Y))&&J("overflow"),L+=Q*Y,ae=se<=$?F:se>=$+K?K:se-$,!(Q<ae);se+=U)ce=U-ae,Y>b(T/ce)&&J("overflow"),Y*=ce;I=u.length+1,$=Z(L-oe,I,oe==0),b(L/I)>T-D&&J("overflow"),D+=b(L/I),L%=I,u.splice(L++,0,D)}return c(u)}function z(i){var u,w,I,L,D,$,R,re,ne,oe,Y,se=[],Q,ae,ce,he;for(i=e(i),Q=i.length,u=G,w=0,D=E,$=0;$<Q;++$)Y=i[$],Y<128&&se.push(k(Y));for(I=L=se.length,L&&se.push(r);I<Q;){for(R=T,$=0;$<Q;++$)Y=i[$],Y>=u&&Y<R&&(R=Y);for(ae=I+1,R-u>b((T-w)/ae)&&J("overflow"),w+=(R-u)*ae,u=R,$=0;$<Q;++$)if(Y=i[$],Y<u&&++w>T&&J("overflow"),Y==u){for(re=w,ne=U;oe=ne<=D?F:ne>=D+K?K:ne-D,!(re<oe);ne+=U)he=re-oe,ce=U-oe,se.push(k(te(oe+he%ce,0))),re=b(he/ce);se.push(k(te(re,0))),D=Z(w,ae,I==L),w=0,++I}++w,++u}return se.join("")}function h(i){return C(i,function(u){return v.test(u)?j(u.slice(4).toLowerCase()):u})}function X(i){return C(i,function(u){return f.test(u)?"xn--"+z(u):u})}q={version:"1.3.2",ucs2:{decode:e,encode:c},decode:j,encode:z,toASCII:X,toUnicode:h},m=function(){return q}.call(d,a,d,O),m!==void 0&&(O.exports=m)})(this)},4041:O=>{"use strict";function d(a,m){return Object.prototype.hasOwnProperty.call(a,m)}O.exports=function(a,m,l,H){m=m||"&",l=l||"=";var S={};if(typeof a!="string"||a.length===0)return S;var x=/\+/g;a=a.split(m);var q=1e3;H&&typeof H.maxKeys=="number"&&(q=H.maxKeys);var T=a.length;q>0&&T>q&&(T=q);for(var U=0;U<T;++U){var F=a[U].replace(x,"%20"),K=F.indexOf(l),A,M,E,G;K>=0?(A=F.substr(0,K),M=F.substr(K+1)):(A=F,M=""),E=decodeURIComponent(A),G=decodeURIComponent(M),d(S,E)?Array.isArray(S[E])?S[E].push(G):S[E]=[S[E],G]:S[E]=G}return S}},3145:O=>{"use strict";var d=function(a){switch(typeof a){case"string":return a;case"boolean":return a?"true":"false";case"number":return isFinite(a)?a:"";default:return""}};O.exports=function(a,m,l,H){return m=m||"&",l=l||"=",a===null&&(a=void 0),typeof a=="object"?Object.keys(a).map(function(S){var x=encodeURIComponent(d(S))+l;return Array.isArray(a[S])?a[S].map(function(q){return x+encodeURIComponent(d(q))}).join(m):x+encodeURIComponent(d(a[S]))}).join(m):H?encodeURIComponent(d(H))+l+encodeURIComponent(d(a)):""}},3486:(O,d,a)=>{"use strict";d.decode=d.parse=a(4041),d.encode=d.stringify=a(3145)},883:(O,d,a)=>{var m=a(9639);d.parse=f,d.resolve=P,d.resolveObject=_,d.format=V,d.Url=l;function l(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var H=/^([a-z0-9.+-]+:)/i,S=/:[0-9]*$/,x=["<",">",'"',"`"," ","\r",`
`,"	"],q=["{","}","|","\\","^","`"].concat(x),T=["'"].concat(q),U=["%","/","?",";","#"].concat(T),F=["/","?","#"],K=255,A=/^[a-z0-9A-Z_-]{0,63}$/,M=/^([a-z0-9A-Z_-]{0,63})(.*)$/,E={javascript:!0,"javascript:":!0},G={javascript:!0,"javascript:":!0},r={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},v=a(3486);function f(t,C,e){if(t&&k(t)&&t instanceof l)return t;var c=new l;return c.parse(t,C,e),c}l.prototype.parse=function(t,C,e){if(!b(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var c=t;c=c.trim();var g=H.exec(c);if(g){g=g[0];var te=g.toLowerCase();this.protocol=te,c=c.substr(g.length)}if(e||g||c.match(/^\/\/[^@\/]+@[^@\/]+/)){var Z=c.substr(0,2)==="//";Z&&!(g&&G[g])&&(c=c.substr(2),this.slashes=!0)}if(!G[g]&&(Z||g&&!r[g])){for(var j=-1,z=0;z<F.length;z++){var h=c.indexOf(F[z]);h!==-1&&(j===-1||h<j)&&(j=h)}var X,i;j===-1?i=c.lastIndexOf("@"):i=c.lastIndexOf("@",j),i!==-1&&(X=c.slice(0,i),c=c.slice(i+1),this.auth=decodeURIComponent(X)),j=-1;for(var z=0;z<U.length;z++){var h=c.indexOf(U[z]);h!==-1&&(j===-1||h<j)&&(j=h)}j===-1&&(j=c.length),this.host=c.slice(0,j),c=c.slice(j),this.parseHost(),this.hostname=this.hostname||"";var u=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!u)for(var w=this.hostname.split(/\./),z=0,I=w.length;z<I;z++){var L=w[z];if(!!L&&!L.match(A)){for(var D="",$=0,R=L.length;$<R;$++)L.charCodeAt($)>127?D+="x":D+=L[$];if(!D.match(A)){var re=w.slice(0,z),ne=w.slice(z+1),oe=L.match(M);oe&&(re.push(oe[1]),ne.unshift(oe[2])),ne.length&&(c="/"+ne.join(".")+c),this.hostname=re.join(".");break}}}if(this.hostname.length>K?this.hostname="":this.hostname=this.hostname.toLowerCase(),!u){for(var Y=this.hostname.split("."),se=[],z=0;z<Y.length;++z){var Q=Y[z];se.push(Q.match(/[^A-Za-z0-9_-]/)?"xn--"+m.encode(Q):Q)}this.hostname=se.join(".")}var ae=this.port?":"+this.port:"",ce=this.hostname||"";this.host=ce+ae,this.href+=this.host,u&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),c[0]!=="/"&&(c="/"+c))}if(!E[te])for(var z=0,I=T.length;z<I;z++){var he=T[z],de=encodeURIComponent(he);de===he&&(de=escape(he)),c=c.split(he).join(de)}var o=c.indexOf("#");o!==-1&&(this.hash=c.substr(o),c=c.slice(0,o));var n=c.indexOf("?");if(n!==-1?(this.search=c.substr(n),this.query=c.substr(n+1),C&&(this.query=v.parse(this.query)),c=c.slice(0,n)):C&&(this.search="",this.query={}),c&&(this.pathname=c),r[te]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var ae=this.pathname||"",Q=this.search||"";this.path=ae+Q}return this.href=this.format(),this};function V(t){return b(t)&&(t=f(t)),t instanceof l?t.format():l.prototype.format.call(t)}l.prototype.format=function(){var t=this.auth||"";t&&(t=encodeURIComponent(t),t=t.replace(/%3A/i,":"),t+="@");var C=this.protocol||"",e=this.pathname||"",c=this.hash||"",g=!1,te="";this.host?g=t+this.host:this.hostname&&(g=t+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(g+=":"+this.port)),this.query&&k(this.query)&&Object.keys(this.query).length&&(te=v.stringify(this.query));var Z=this.search||te&&"?"+te||"";return C&&C.substr(-1)!==":"&&(C+=":"),this.slashes||(!C||r[C])&&g!==!1?(g="//"+(g||""),e&&e.charAt(0)!=="/"&&(e="/"+e)):g||(g=""),c&&c.charAt(0)!=="#"&&(c="#"+c),Z&&Z.charAt(0)!=="?"&&(Z="?"+Z),e=e.replace(/[?#]/g,function(j){return encodeURIComponent(j)}),Z=Z.replace("#","%23"),C+g+e+Z+c};function P(t,C){return f(t,!1,!0).resolve(C)}l.prototype.resolve=function(t){return this.resolveObject(f(t,!1,!0)).format()};function _(t,C){return t?f(t,!1,!0).resolveObject(C):C}l.prototype.resolveObject=function(t){if(b(t)){var C=new l;C.parse(t,!1,!0),t=C}var e=new l;if(Object.keys(this).forEach(function(R){e[R]=this[R]},this),e.hash=t.hash,t.href==="")return e.href=e.format(),e;if(t.slashes&&!t.protocol)return Object.keys(t).forEach(function(R){R!=="protocol"&&(e[R]=t[R])}),r[e.protocol]&&e.hostname&&!e.pathname&&(e.path=e.pathname="/"),e.href=e.format(),e;if(t.protocol&&t.protocol!==e.protocol){if(!r[t.protocol])return Object.keys(t).forEach(function(R){e[R]=t[R]}),e.href=e.format(),e;if(e.protocol=t.protocol,!t.host&&!G[t.protocol]){for(var X=(t.pathname||"").split("/");X.length&&!(t.host=X.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),X[0]!==""&&X.unshift(""),X.length<2&&X.unshift(""),e.pathname=X.join("/")}else e.pathname=t.pathname;if(e.search=t.search,e.query=t.query,e.host=t.host||"",e.auth=t.auth,e.hostname=t.hostname||t.host,e.port=t.port,e.pathname||e.search){var c=e.pathname||"",g=e.search||"";e.path=c+g}return e.slashes=e.slashes||t.slashes,e.href=e.format(),e}var te=e.pathname&&e.pathname.charAt(0)==="/",Z=t.host||t.pathname&&t.pathname.charAt(0)==="/",j=Z||te||e.host&&t.pathname,z=j,h=e.pathname&&e.pathname.split("/")||[],X=t.pathname&&t.pathname.split("/")||[],i=e.protocol&&!r[e.protocol];if(i&&(e.hostname="",e.port=null,e.host&&(h[0]===""?h[0]=e.host:h.unshift(e.host)),e.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(X[0]===""?X[0]=t.host:X.unshift(t.host)),t.host=null),j=j&&(X[0]===""||h[0]==="")),Z)e.host=t.host||t.host===""?t.host:e.host,e.hostname=t.hostname||t.hostname===""?t.hostname:e.hostname,e.search=t.search,e.query=t.query,h=X;else if(X.length)h||(h=[]),h.pop(),h=h.concat(X),e.search=t.search,e.query=t.query;else if(!J(t.search)){if(i){e.hostname=e.host=h.shift();var u=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;u&&(e.auth=u.shift(),e.host=e.hostname=u.shift())}return e.search=t.search,e.query=t.query,(!p(e.pathname)||!p(e.search))&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.href=e.format(),e}if(!h.length)return e.pathname=null,e.search?e.path="/"+e.search:e.path=null,e.href=e.format(),e;for(var w=h.slice(-1)[0],I=(e.host||t.host)&&(w==="."||w==="..")||w==="",L=0,D=h.length;D>=0;D--)w=h[D],w=="."?h.splice(D,1):w===".."?(h.splice(D,1),L++):L&&(h.splice(D,1),L--);if(!j&&!z)for(;L--;L)h.unshift("..");j&&h[0]!==""&&(!h[0]||h[0].charAt(0)!=="/")&&h.unshift(""),I&&h.join("/").substr(-1)!=="/"&&h.push("");var $=h[0]===""||h[0]&&h[0].charAt(0)==="/";if(i){e.hostname=e.host=$?"":h.length?h.shift():"";var u=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;u&&(e.auth=u.shift(),e.host=e.hostname=u.shift())}return j=j||e.host&&h.length,j&&!$&&h.unshift(""),h.length?e.pathname=h.join("/"):(e.pathname=null,e.path=null),(!p(e.pathname)||!p(e.search))&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.auth=t.auth||e.auth,e.slashes=e.slashes||t.slashes,e.href=e.format(),e},l.prototype.parseHost=function(){var t=this.host,C=S.exec(t);C&&(C=C[0],C!==":"&&(this.port=C.substr(1)),t=t.substr(0,t.length-C.length)),t&&(this.hostname=t)};function b(t){return typeof t=="string"}function k(t){return typeof t=="object"&&t!==null}function p(t){return t===null}function J(t){return t==null}}},fe={};function ee(O){var d=fe[O];if(d!==void 0)return d.exports;var a=fe[O]={id:O,loaded:!1,exports:{}};return ve[O].call(a.exports,a,a.exports,ee),a.loaded=!0,a.exports}(()=>{ee.d=(O,d)=>{for(var a in d)ee.o(d,a)&&!ee.o(O,a)&&Object.defineProperty(O,a,{enumerable:!0,get:d[a]})}})(),(()=>{ee.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch(O){if(typeof window=="object")return window}}()})(),(()=>{ee.o=(O,d)=>Object.prototype.hasOwnProperty.call(O,d)})(),(()=>{ee.r=O=>{typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(O,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(O,"__esModule",{value:!0})}})(),(()=>{ee.nmd=O=>(O.paths=[],O.children||(O.children=[]),O)})();var ge={};return(()=>{"use strict";ee.r(ge),ee.d(ge,{SubsSdk:()=>de});var O=ee(8048),d=ee(883),a=Object.defineProperty,m=Object.defineProperties,l=Object.getOwnPropertyDescriptors,H=Object.getOwnPropertySymbols,S=Object.prototype.hasOwnProperty,x=Object.prototype.propertyIsEnumerable,q=(o,n,s)=>n in o?a(o,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[n]=s,T=(o,n)=>{for(var s in n||(n={}))S.call(n,s)&&q(o,s,n[s]);if(H)for(var s of H(n))x.call(n,s)&&q(o,s,n[s]);return o},U=(o,n)=>m(o,l(n));async function F(o){const{ok:n,status:s,statusText:y}=o,N={ok:n,status:s,statusText:y};let W="";try{if(W=await o.text(),!n)return U(T({},N),{data:{text:W}});const B=JSON.parse(W);return U(T({},N),{data:B})}catch(B){return U(T({},N),{data:{text:W}})}}var K=Object.defineProperty,A=Object.defineProperties,M=Object.getOwnPropertyDescriptors,E=Object.getOwnPropertySymbols,G=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,v=(o,n,s)=>n in o?K(o,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[n]=s,f=(o,n)=>{for(var s in n||(n={}))G.call(n,s)&&v(o,s,n[s]);if(E)for(var s of E(n))r.call(n,s)&&v(o,s,n[s]);return o},V=(o,n)=>A(o,M(n));function P(o,n){return n.reduce((y,N)=>{const W=o.headers.get(N);return V(f({},y),{[N]:W})},{})}var _=Object.defineProperty,b=Object.defineProperties,k=Object.getOwnPropertyDescriptors,p=Object.getOwnPropertySymbols,J=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,C=(o,n,s)=>n in o?_(o,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[n]=s,e=(o,n)=>{for(var s in n||(n={}))J.call(n,s)&&C(o,s,n[s]);if(p)for(var s of p(n))t.call(n,s)&&C(o,s,n[s]);return o},c=(o,n)=>b(o,k(n)),g=(o,n)=>{var s={};for(var y in o)J.call(o,y)&&n.indexOf(y)<0&&(s[y]=o[y]);if(o!=null&&p)for(var y of p(o))n.indexOf(y)<0&&t.call(o,y)&&(s[y]=o[y]);return s};async function te(o,n={}){const s=new Date().getTime(),y=o,{responseHeaders:N}=y,W=g(y,["responseHeaders"]),B=d.format(W),pe=(0,O.createLogger)("dal",{url:B});try{const ue=await fetch(B,n),me=await F(ue);if(N){const le=P(ue,N);me.data=c(e({},me.data),{responseHeaders:le})}return pe.info({responseTime:`${Date.now()-s}ms`,fetchOptions:n},"dal request"),me}catch(ue){switch(!0){case(ue.name==="FetchError"&&ue.type==="request-timeout"):throw new Error(`Timeout exceeded for ${B}`);case(ue.name==="FetchError"&&ue.type==="invalid-json"):throw new Error(`Got non-JSON or invalid JSON response for ${B}`);default:throw ue}}}var Z=ee(1866);const j=(o,n,s,y)=>{var N,W;const B=s?`${s}_`:"",pe=`${o}_${n}`;return(W=(N=Z.env[`${B}${pe}_CLIENT`])!=null?N:Z.env[`${pe}_CLIENT`])!=null?W:y},z="PIANO",h="WX_API",X=j(h,"HOST",z),i=j(h,"PROTOCOL",z,"https");function u({host:o,protocol:n,ns:s="wx"}={}){const y=o!=null?o:X,N=n!=null?n:i;return{host:y,protocol:N,pathname:`/api/v1/piano/key/${s}/upsx`}}const w="LOGOUT",I="UPSX",L=j(I,"HOST",w),D=j(I,"PROTOCOL",w,"https");function $({host:o,protocol:n}={}){const s=o!=null?o:L,y=n!=null?n:D;return{host:s,protocol:y,pathname:"logout",credentials:"include",method:"POST"}}const R=(0,O.createLogger)("script-loader"),re="loaded",ne="complete",oe="failure",Y="success",se=o=>o.readyState?o.readyState===re||o.readyState===ne:!0,Q=(o,n={},s="head")=>new Promise((y,N)=>{const W=document.querySelector(s);W||N(new Error(`${s} not found in document`));const B=document.createElement("script");B.type="text/javascript",B.src=o,Object.keys(n).forEach(pe=>{B[pe]=n[pe]}),B.onerror=()=>{n.onerror&&(R.debug(n.onerror,`Calling onerror attribute for script ${o}`),n.onerror()),R.error(`Error occurred loading script ${o}`),y(oe)},B.onload=()=>{se(B)&&(n.onload&&(R.debug(n.onload,`Calling onload attribute for script ${o}`),n.onload()),R.debug(`Successfully loaded script ${o}`),y(Y))},B.readyState&&(B.onreadystatechange=()=>{(B.readyState===re||B.readyState===ne)&&(n.onreadystatechange&&(R.debug(n.onreadystatechange,`Calling onreadystatechange attribute for script ${o}`),n.onreadystatechange()),y(Y))}),R.debug(`Loading script ${o}`),W.appendChild(B)}),ae=(o,n)=>new Promise(s=>{const y="jsonp_callback_"+Math.round(1e5*Math.random()),N=document.createElement("script"),W=o.replace(/=\?/,"="+y);window[y]=B=>{window[y]=null,R.debug(`Successful callback for ${W}`),s(B)},N.async=n,N.src=W,N.onerror=()=>{R.error(`Error occurred loading script ${W}`),s(oe)},R.debug(`Loading script ${W}`),document.getElementsByTagName("head")[0].appendChild(N)}),ce=(0,O.createLogger)("SubsSdk");class he{constructor(){return this._initialized=!1,this.subscribers=[],this.signUpSubscribeOpenModal="signUpSubscribeOpenModal",this.loginSubscribeOpenModal="loginSubscribeOpenModal",this.signUpSubscribeSuccess="signUpSubscribeSuccess",this.pianoLoginSuccess="pianoLoginSuccess",this.startCheckout="startCheckout",this.checkoutComplete="checkoutComplete",this.checkoutCompleted="checkoutCompleted",this.close="close",this.checkoutClose="checkoutClose",this.checkoutCustomEvent="checkoutCustomEvent",this.checkoutError="checkoutError",this.checkoutSelectTerm="checkoutSelectTerm",this.checkoutStateChange="checkoutStateChange",this.showOffer="showOffer",this.showTemplate="showTemplate",this.startCheckout="startCheckout",this.submitPayment="submitPayment",this.loginRequired="loginRequired",this.loginSuccess="loginSuccess",window.SubsSdk=window.SubsSdk||this,window.tp=window.tp||[],window.SubsSdk}async init({pianoAppID:n,tinyPassHost:s,pianoKeyHost:y,isUserLoggedIn:N}){ce.debug({pianoAppID:n,tinyPassHost:s,pianoKeyHost:y,initialized:this._initialized},"........ SubsSdk.init");try{if(!this._initialized&&n&&s){window.tp.push(["setAid",`${n}`]),window.tp.push(["setEndpoint",`https://${s}/api/v3`]);const{pkRequired:W}=window;W&&N&&await this.initPianoKeyRef(y),this.queuePianoExperience(),await this._addPianoMinScript({tinyPassHost:s})}this._initialized=!0}catch(W){ce.error("ERROR : could not initialize piano init service",W)}}async _getPianoKeyUserRef(n){const s=n||"";return(await te(u({host:s,protocol:s?null:""}),{credentials:"include"})).data}async logoutUser(n){await te($({upsHost:n,upsProtocol:n?null:""}),{method:"POST",credentials:"include"})}async initSubscribe(n,s){await this._addPianoHandlersScript({pianoKeyHost:n,upsHost:s})}async initMemberSubscription(n,s){var y;((y=window==null?void 0:window.tp)==null?void 0:y.userRef)||(this.logoutUser(s),window.location.href="/login"),window.tp.push(["init",async()=>{window.tp.myaccount.show({displayMode:"inline",containerSelector:n||""})}])}async _addPianoMinScript({tinyPassHost:n}){if(!!n)return Q("//cdn.piano.io/api/piano.js")}async _addPianoHandlersScript({pianoKeyHost:n,upsHost:s}){const y=ie=>{this.publish(this.checkoutClose,{event:ie})},N=ie=>{this.publish(this.checkoutComplete,{data:ie})},W=ie=>{this.publish(this.checkoutCustomEvent,{event:ie})},B=ie=>{this.publish(this.checkoutError,{data:ie})},pe=ie=>{this.publish(this.submitPayment,{event:ie})},ue=ie=>{this.publish(this.loginSuccess,{data:ie})},me=async ie=>await new Promise(async _e=>{if(ie){const Se=this.subscribe(this.signUpSubscribeSuccess,async()=>{Se.unsubscribe();const{tp:Pe}=window,we=await this.initPianoKeyRef(n,s);this.publish(this.pianoLoginSuccess,{data:!!we}),we?Pe.offer.startCheckout(ie):(this.logoutUser(s),window.location.reload()),_e(we)})}const Oe=window.anySuccessLogin?this.loginSubscribeOpenModal:this.signUpSubscribeOpenModal;this.publish(Oe,{data:ie,open:!0})}),{tp:le}=window;le.push(["setUseTinypassAccounts",!1]),le.push(["addHandler","checkoutComplete",N]),le.push(["addHandler","checkoutClose",y]),le.push(["addHandler","checkoutCustomEvent",W]),le.push(["addHandler","checkoutError",B]),le.push(["addHandler","checkoutSubmitPayment",pe]),le.push(["addHandler","loginRequired",me]),le.push(["addHandler","loginSuccess",ue])}async initPianoKeyRef(n){const{key:s}=await this._getPianoKeyUserRef(n)||{};return window.tp.push(["setUserRef",s]),s}queuePianoExperience(){window.tp.push(["init",()=>{window.tp.experience.init()}])}subscribe(n,s){const{subscribers:y}=this;y[n]||(y[n]=[]);const N=y[n].push(s)-1;return{unsubscribe(){y[n].splice(N,1)}}}publish(n,s){!this.subscribers[n]||this.subscribers[n].forEach(y=>{y(s)})}}const de=new he})(),ge})()})});Ce();})();

//# sourceMappingURL=subsSdkScript.js.map